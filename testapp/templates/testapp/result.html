<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Result</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #43cea2, #185a9d);
            font-family: 'Segoe UI', sans-serif;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
        }

        .review-card {
            background: #ffffff;
            border-radius: 16px;
        }

        .correct {
            background-color: #d4edda;
            border-left: 5px solid #28a745;
            border-radius: 8px;
        }

        .wrong {
            background-color: #f8d7da;
            border-left: 5px solid #dc3545;
            border-radius: 8px;
        }
    </style>
</head>

<body>

<div class="container py-5">

    <!-- SUMMARY -->
    <div class="card summary-card shadow p-4 mb-4 text-center">
        <h2 class="text-success fw-bold">‚úÖ Test Completed</h2>
        <h4>Your Score: <b>{{ score }}</b> / {{ total }}</h4>

        <div class="progress mt-3" style="height:20px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                 style="width: {{ percentage }}%;">
                {{ percentage }}%
            </div>
        </div>
    </div>

    <!-- TOGGLE BUTTON -->
    <div class="text-center mb-4">
        <button class="btn btn-warning btn-lg"
                onclick="toggleReview()"
                id="reviewBtn">
            üìò Show Answer Review
        </button>
    </div>

    <!-- ANSWER REVIEW -->
    <div id="answerReview" style="display:none;">

        <h3 class="text-white mb-3">üìñ Answer Review</h3>

        {% for item in review_data %}
        <div class="card review-card shadow mb-4 p-3">

            <h5 class="fw-bold">
                Q{{ forloop.counter }}. {{ item.question.question_text }}
            </h5>

            {% for opt in item.options %}
            <div class="p-2 mt-2
                {% if opt.id == item.correct_option_id %}
                    correct
                {% elif opt.id == item.selected_option_id %}
                    wrong
                {% endif %}
            ">
                {{ opt.option_text }}

                {% if opt.id == item.correct_option_id %}
                    <span class="badge bg-success ms-2">Correct</span>
                {% elif opt.id == item.selected_option_id %}
                    <span class="badge bg-danger ms-2">Your Answer</span>
                {% endif %}
            </div>
            {% endfor %}

            {% if item.question.explanation %}
            <div class="alert alert-info mt-3">
                <b>Explanation:</b> {{ item.question.explanation }}
            </div>
            {% endif %}

        </div>
        {% endfor %}

    </div>

    <div class="text-center mt-4">
        <a href="/" class="btn btn-light btn-lg rounded-pill">
            üîÅ Retake Test
        </a>
    </div>

</div>

<script>
    function toggleReview() {
        const review = document.getElementById("answerReview");
        const btn = document.getElementById("reviewBtn");

        if (review.style.display === "none") {
            review.style.display = "block";
            btn.innerText = "‚ùå Hide Answer Review";
        } else {
            review.style.display = "none";
            btn.innerText = "üìò Show Answer Review";
        }
    }
</script>

</body>
</html>
